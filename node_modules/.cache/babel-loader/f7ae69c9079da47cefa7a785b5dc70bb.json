{"ast":null,"code":"import _slicedToArray from\"/home/javier.sosa/Escritorio/JS PROJECTS/whatsapp-clone/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState}from'react';import{Avatar,IconButton}from\"@material-ui/core\";import MoreVertIcon from\"@material-ui/icons/MoreVert\";import SearchOutlined from\"@material-ui/icons/SearchOutlined\";import AttachFile from\"@material-ui/icons/AttachFile\";import InsertEmoticonIcon from\"@material-ui/icons/InsertEmoticon\";import MicIcon from\"@material-ui/icons/Mic\";import{useParams}from\"react-router-dom\";import db from\"./firebase\";import{doc,onSnapshot,collection,query,orderBy,addDoc}from\"./firebase\";import{useStateValue}from\"./StateProvider\";import{serverTimestamp}from'@firebase/firestore';import\"./Chat.css\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function Chat(){var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),input=_useState2[0],setInput=_useState2[1];var _useState3=useState(\"\"),_useState4=_slicedToArray(_useState3,2),seed=_useState4[0],setSeed=_useState4[1];var _useParams=useParams(),roomId=_useParams.roomId;var _useState5=useState(\"\"),_useState6=_slicedToArray(_useState5,2),roomName=_useState6[0],setRoomName=_useState6[1];var _useState7=useState([]),_useState8=_slicedToArray(_useState7,2),messages=_useState8[0],setMessages=_useState8[1];var _useStateValue=useStateValue(),_useStateValue2=_slicedToArray(_useStateValue,2),user=_useStateValue2[0].user,dispatch=_useStateValue2[1];useEffect(function(){if(roomId){onSnapshot(doc(db,\"rooms\",\"\".concat(roomId)),function(snapshot){setRoomName(snapshot.data().name);});var messagesCollection=query(collection(db,\"rooms\",\"\".concat(roomId),\"messages\"),orderBy(\"timestamp\",\"asc\"));onSnapshot(messagesCollection,function(snapshot){setMessages(snapshot.docs.map(function(doc){return doc.data();}));});}},[roomId]);useEffect(function(){setSeed(Math.floor(Math.random()*5000));},[roomId]);var sendMessage=function sendMessage(e){e.preventDefault();console.log(\"You type >>> \",input);addDoc(collection(db,\"rooms\",\"\".concat(roomId),\"messages\"),{message:input,name:user.displayName,timestamp:serverTimestamp()});setInput('');};var lastSeen=function lastSeen(){if(messages.length>0){var _messages,_messages$timestamp;return new Date((_messages=messages[messages.length-1])===null||_messages===void 0?void 0:(_messages$timestamp=_messages.timestamp)===null||_messages$timestamp===void 0?void 0:_messages$timestamp.toDate()).toLocaleString();}else{return\"...\";}};return/*#__PURE__*/_jsxs(\"div\",{className:\"chat\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"chat__header\",children:[/*#__PURE__*/_jsx(Avatar,{src:\"https://avatars.dicebear.com/api/human/\".concat(seed,\".svg\")}),/*#__PURE__*/_jsxs(\"div\",{className:\"chat__headerInfo\",children:[/*#__PURE__*/_jsx(\"h3\",{children:roomName}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Last seen \",\" \",\" \",lastSeen()]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"chat__headerRight\",children:[/*#__PURE__*/_jsx(IconButton,{children:/*#__PURE__*/_jsx(SearchOutlined,{})}),/*#__PURE__*/_jsx(IconButton,{children:/*#__PURE__*/_jsx(AttachFile,{})}),/*#__PURE__*/_jsx(IconButton,{children:/*#__PURE__*/_jsx(MoreVertIcon,{})})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"chat__body\",children:messages.map(function(message){var _message$timestamp;return/*#__PURE__*/_jsxs(\"p\",{className:\"chat__message \".concat(message.name===user.displayName&&\"chat__reciever\"),children:[/*#__PURE__*/_jsx(\"span\",{className:\"chat__name\",children:message.name}),message.message,/*#__PURE__*/_jsx(\"span\",{className:\"chat__timestamp\",children:new Date((_message$timestamp=message.timestamp)===null||_message$timestamp===void 0?void 0:_message$timestamp.toDate()).toLocaleString()})]});})}),/*#__PURE__*/_jsxs(\"div\",{className:\"chat__footer\",children:[/*#__PURE__*/_jsx(IconButton,{children:/*#__PURE__*/_jsx(InsertEmoticonIcon,{})}),/*#__PURE__*/_jsxs(\"form\",{children:[/*#__PURE__*/_jsx(\"input\",{value:input,onChange:function onChange(e){return setInput(e.target.value);},placeholder:\"Type a message\",type:\"text\"}),/*#__PURE__*/_jsx(\"button\",{onClick:sendMessage,type:\"submit\",children:\"Send a message\"})]}),/*#__PURE__*/_jsx(IconButton,{children:/*#__PURE__*/_jsx(MicIcon,{})})]})]});}export default Chat;","map":{"version":3,"sources":["/home/javier.sosa/Escritorio/JS PROJECTS/whatsapp-clone/src/Chat.js"],"names":["React","useEffect","useState","Avatar","IconButton","MoreVertIcon","SearchOutlined","AttachFile","InsertEmoticonIcon","MicIcon","useParams","db","doc","onSnapshot","collection","query","orderBy","addDoc","useStateValue","serverTimestamp","Chat","input","setInput","seed","setSeed","roomId","roomName","setRoomName","messages","setMessages","user","dispatch","snapshot","data","name","messagesCollection","docs","map","Math","floor","random","sendMessage","e","preventDefault","console","log","message","displayName","timestamp","lastSeen","length","Date","toDate","toLocaleString","target","value"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { Avatar, IconButton } from \"@material-ui/core\";\nimport MoreVertIcon from \"@material-ui/icons/MoreVert\";\nimport SearchOutlined from \"@material-ui/icons/SearchOutlined\";\nimport AttachFile from \"@material-ui/icons/AttachFile\";\nimport InsertEmoticonIcon from \"@material-ui/icons/InsertEmoticon\";\nimport MicIcon from \"@material-ui/icons/Mic\";\nimport { useParams } from \"react-router-dom\";\nimport db from \"./firebase\";\nimport { doc, onSnapshot, collection, query, orderBy, addDoc } from \"./firebase\";\nimport { useStateValue } from \"./StateProvider\";\nimport { serverTimestamp } from '@firebase/firestore'\nimport \"./Chat.css\";\n\n\nfunction Chat() {\n    const [input, setInput] = useState(\"\");\n    const [seed, setSeed] = useState(\"\");\n    const { roomId } = useParams();\n    const [roomName, setRoomName] = useState(\"\");\n    const [messages, setMessages] = useState([]);\n    const [{ user }, dispatch] = useStateValue();\n\n    useEffect(() => {\n\n        if (roomId) {\n            onSnapshot(doc(db, \"rooms\", `${roomId}`), (snapshot) => {\n                setRoomName(snapshot.data().name);\n            });\n\n            const messagesCollection = query(collection(db, \"rooms\", `${roomId}`, \"messages\"), orderBy(\"timestamp\", \"asc\"));\n            onSnapshot(messagesCollection, (snapshot) => {\n                setMessages(snapshot.docs.map((doc) => \n                    doc.data()\n                ))\n            });\n        }\n    }, [roomId]);\n\n    useEffect(() => {\n        setSeed(Math.floor(Math.random() * 5000));\n    }, [roomId]);\n\n    const sendMessage = (e) => {\n        e.preventDefault();\n        console.log(\"You type >>> \", input);\n\n        addDoc(collection(db, \"rooms\", `${roomId}`, \"messages\"), {\n            message: input,\n            name: user.displayName,\n            timestamp: serverTimestamp()\n        });\n\n        setInput('');\n    };\n\n    const lastSeen = () => {\n\n        if (messages.length > 0) {\n            return new Date(messages[messages.length - 1]?.timestamp?.toDate()).toLocaleString();\n        } else {\n            return \"...\";\n        }\n    }\n\n    return (\n        <div className=\"chat\">\n            <div className=\"chat__header\">\n                <Avatar src={`https://avatars.dicebear.com/api/human/${seed}.svg`} />\n                \n                <div className=\"chat__headerInfo\">\n                    <h3>{roomName}</h3>\n                    <p>Last seen {\" \"} {lastSeen()}</p>\n                </div>\n\n                <div className=\"chat__headerRight\">\n                    <IconButton>\n                        <SearchOutlined />\n                    </IconButton>\n                    <IconButton>\n                        <AttachFile />\n                    </IconButton>\n                    <IconButton>\n                        <MoreVertIcon />\n                    </IconButton>\n                </div>\n            </div>\n\n            <div className=\"chat__body\">\n                {messages.map((message) => (\n                    <p className={`chat__message ${message.name === user.displayName && \"chat__reciever\"}`}>\n                        <span className=\"chat__name\">{message.name}</span>\n                            {message.message}\n                        <span className=\"chat__timestamp\">{new Date(message.timestamp?.toDate()).toLocaleString()}</span>\n                    </p>\n                ))}\n                \n            </div>\n\n            <div className=\"chat__footer\">\n                <IconButton>\n                    <InsertEmoticonIcon />\n                </IconButton>\n                <form>\n                    <input value={input} onChange={(e) => setInput(e.target.value)} placeholder=\"Type a message\" type=\"text\" />\n                    <button onClick={sendMessage} type=\"submit\">Send a message</button>\n                </form>\n                <IconButton>\n                    <MicIcon />\n                </IconButton>\n            </div>\n        </div>\n    );\n}\n\nexport default Chat\n"]},"metadata":{},"sourceType":"module"}